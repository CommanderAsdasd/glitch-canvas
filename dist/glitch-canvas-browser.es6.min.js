function glitch(a){function t(){return a}function e(){var a=objectAssign({},w);return l||objectAssign(a,I),a}function n(){var a=objectAssign({},w);return b||objectAssign(a,y),a}function i(a){return a}function r(a){return c(imageToImageData,a)}function s(a){return c(i,a)}function o(a){return g(i)}function u(a){return g(base64URLToImage,a,!0)}function h(a){return g(base64URLToImageData,a,!0)}function c(a,t,e){return l=function(){return new Promise(function(n,r){if(e)a(t,n,r);else if(a===i)n(t);else try{n(a(t,n,r))}catch(a){r(a)}})},f()?m():n()}function g(a,t,n){return b=function(e){return new Promise(function(r,s){n?a(e,t,r,s):a===i?r(e):a(e,t).then(r,s)})},f()?m():e()}function f(){return l&&b}function m(){return new Promise(function(t,e){l().then(function(t){return d(t,a)},e).then(function(a){b(a).then(t,e)},e)})}function d(a,t){return new Promise(function(e,n){imageDataToBase64(a,t.quality).then(function(e){return p(a,e,t)},n).then(e,n)})}function p(a,t,e){return new Promise(function(n,i){v.addEventListener("message",function(a){a.data&&a.data.base64URL?n(a.data.base64URL):i(a.data&&a.data.err?a.data.err:a)}),v.postMessage({params:e,base64URL:t,imageData:a,imageDataWidth:a.width,imageDataHeight:a.height})})}a=sanitizeInput(a);let l,b,v=new Worker(URL.createObjectURL(new Blob(['function fail(a){self.postMessage({err:a.message||a})}function success(a){self.postMessage({base64URL:a})}var isImageData=function(a){return a&&"number"==typeof a.width&&"number"==typeof a.height&&a.data&&"number"==typeof a.data.length&&"object"==typeof a.data};const base64Chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64Map=base64Chars.split(""),reversedBase64Map$1={};base64Map.forEach(function(a,e){reversedBase64Map$1[a]=e});var maps={base64Map:base64Map,reversedBase64Map:reversedBase64Map$1};const reversedBase64Map=maps.reversedBase64Map;var base64ToByteArray=function(a){for(var e,s,t=[],r=23,i=a.length;r<i;r++){switch(e=reversedBase64Map[a.charAt(r)],(r-23)%4){case 1:t.push(s<<2|e>>4);break;case 2:t.push((15&s)<<4|e>>2);break;case 3:t.push((3&s)<<6|e)}s=e}return t},jpgHeaderLength=function(a){for(var e=417,s=0,t=a.length;s<t;s++)if(255===a[s]&&218===a[s+1]){e=s+2;break}return e},glitchByteArray=function(a,e,s,t){let r=jpgHeaderLength(a),i=a.length-r-4,n=s/100,p=e/100;for(var h=0;h<t;h++){let e=i/t*h|0,s=i/t*(h+1)|0,o=s-e,g=e+o*p|0;g>i&&(g=i);let c=~~(r+g);a[c]=~~(256*n)}return a};const base64Map$1=maps.base64Map;var byteArrayToBase64=function(a){let e,s,t,r=["data:image/jpeg;base64,"];for(var i=0,n=a.length;i<n;i++){switch(s=a[i],e=i%3){case 0:r.push(base64Map$1[s>>2]);break;case 1:r.push(base64Map$1[(3&t)<<4|s>>4]);break;case 2:r.push(base64Map$1[(15&t)<<2|s>>6]),r.push(base64Map$1[63&s])}t=s}return 0===e?(r.push(base64Map$1[(3&t)<<4]),r.push("==")):1===e&&(r.push(base64Map$1[(15&t)<<2]),r.push("=")),r.join("")},glitchImageData=function(a,e,s){if(isImageData(a)){let a=base64ToByteArray(e),t=glitchByteArray(a,s.seed,s.amount,s.iterations),r=byteArrayToBase64(t);return r}throw new Error("glitchImageData: imageData seems to be corrupt.")};onmessage=function(a){const e=a.data.imageData,s=a.data.params,t=a.data.base64URL;if(e&&t&&s)try{void 0===e.width&&"number"==typeof a.data.imageDataWidth&&(e.width=a.data.imageDataWidth),void 0===e.height&&"number"==typeof a.data.imageDataHeight&&(e.height=a.data.imageDataHeight);const r=glitchImageData(e,t,s);success(r)}catch(a){fail(a)}else fail(a.data.imageData?"Parameters are missing.":"ImageData is missing.");self.close()};'],{type:"text/javascript"}))),w={getParams:t,getInput:e,getOutput:n},I={fromImageData:s,fromImage:r},y={toImage:u,toDataURL:o,toImageData:h};return e()}var clamp=function(a,t,e){return a<t?t:a>e?e:a},clone=function(a){let t=!1;if(void 0!==a)try{t=JSON.parse(JSON.stringify(a))}catch(a){}return t},defaultParams={amount:35,iterations:20,quality:30,seed:25},sanitizeInput=function(a){return"object"!=typeof(a=clone(a))&&(a={}),Object.keys(defaultParams).filter(function(a){return"iterations"!==a}).forEach(function(t){"number"!=typeof a[t]||isNaN(a[t])?a[t]=defaultParams[t]:a[t]=clamp(a[t],0,100),a[t]=Math.round(a[t])}),("number"!=typeof a.iterations||isNaN(a.iterations)||a.iterations<=0)&&(a.iterations=defaultParams.iterations),a.iterations=Math.round(a.iterations),a};class Canvas$1{constructor(a=300,t=150){this.canvasEl=document.createElement("canvas"),this.canvasEl.width=a,this.canvasEl.height=t,this.ctx=this.canvasEl.getContext("2d")}getContext(){return this.ctx}toDataURL(a,t,e){if("function"!=typeof e)return this.canvasEl.toDataURL(a,t);e(this.canvasEl.toDataURL(a,t))}get width(){return this.canvasEl.width}set width(a){this.canvasEl.width=a}get height(){return this.canvasEl.height}set height(a){this.canvasEl.height=a}}Canvas$1.Image=Image;var imageToImageData=function(a){if(a instanceof HTMLImageElement){if(!a.naturalWidth||!a.naturalHeight||!1===a.complete)throw new Error("This this image hasn't finished loading: "+a.src);const t=new Canvas$1(a.naturalWidth,a.naturalHeight),e=t.getContext("2d");e.drawImage(a,0,0,t.width,t.height);const n=e.getImageData(0,0,t.width,t.height);return n.data&&n.data.length&&(void 0===n.width&&(n.width=a.naturalWidth),void 0===n.height&&(n.height=a.naturalHeight)),n}throw new Error("This object does not seem to be an image.")};const Image$2=Canvas$1.Image;var loadBase64Image=function(a){return new Promise(function(t,e){let n=new Image$2;n.onload=function(){t(n)},n.onerror=function(a){e(a)},n.src=a})},base64URLToImage=function(a,t,e,n){loadBase64Image(a).then(e,n)},getImageSize=function(a){return{width:a.width||a.naturalWidth,height:a.height||a.naturalHeight}},canvasFromImage=function(a){let t=getImageSize(a),e=new Canvas$1(t.width,t.height),n=e.getContext("2d");return n.drawImage(a,0,0,t.width,t.height),{canvas:e,ctx:n}},base64URLToImageData=function(a,t,e,n){loadBase64Image(a).then(function(a){let t=getImageSize(a),n=canvasFromImage(a).ctx.getImageData(0,0,t.width,t.height);n.width||(n.width=t.width),n.height||(n.height=t.height),e(n)},n)},isImageData=function(a){return a&&"number"==typeof a.width&&"number"==typeof a.height&&a.data&&"number"==typeof a.data.length&&"object"==typeof a.data},imageDataToBase64=function(a,t){return new Promise(function(e,n){if(isImageData(a)){const n=new Canvas$1(a.width,a.height),i=n.getContext("2d");i.putImageData(a,0,0);const r=n.toDataURL("image/jpeg",t/100);e(r)}else n(new Error("object is not valid imageData"))})};const base64Chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64Map=base64Chars.split(""),reversedBase64Map$1={};base64Map.forEach(function(a,t){reversedBase64Map$1[a]=t});var objectAssign=Object.assign;export default glitch;